<div class="h-screen flex flex-col bg-gray-50">
  <!-- Header -->
  <div class="bg-gradient-to-r from-green-600 to-teal-600 text-white p-6 shadow-lg">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="text-4xl">ğŸ“…</div>
        <div>
          <h1 class="text-2xl font-bold">Google Calendar</h1>
          <p class="text-green-100 text-sm">Gestiona tus eventos y reuniones</p>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <button 
          *ngIf="!isAuthenticated"
          (click)="authorize()"
          class="px-4 py-2 bg-white text-green-600 rounded-lg font-medium hover:bg-green-50 transition flex items-center space-x-2">
          <span>ğŸ”</span>
          <span>Conectar Google</span>
        </button>
        <button 
          *ngIf="isAuthenticated"
          (click)="openCreateModal()"
          class="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition flex items-center space-x-2">
          <span>â•</span>
          <span>Nuevo Evento</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Not Authenticated Warning -->
  <div *ngIf="!isAuthenticated" class="p-6">
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
      <div class="flex">
        <div class="flex-shrink-0">
          <span class="text-2xl">âš ï¸</span>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">Google Calendar no estÃ¡ conectado</h3>
          <p class="mt-2 text-sm text-yellow-700">
            Haz clic en "Conectar Google" para autorizar la aplicaciÃ³n y ver tus eventos.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="isAuthenticated" class="flex-1 overflow-y-auto">
    <!-- View Selector -->
    <div class="bg-white border-b border-gray-200 p-4">
      <div class="flex items-center justify-between">
        <div class="flex space-x-2">
          <button 
            (click)="changeView('today')"
            [class]="currentView === 'today' 
                     ? 'px-4 py-2 bg-green-600 text-white rounded-lg font-medium' 
                     : 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition'">
            Hoy
          </button>
          <button 
            (click)="changeView('week')"
            [class]="currentView === 'week' 
                     ? 'px-4 py-2 bg-green-600 text-white rounded-lg font-medium' 
                     : 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition'">
            Semana
          </button>
          <button 
            (click)="changeView('month')"
            [class]="currentView === 'month' 
                     ? 'px-4 py-2 bg-green-600 text-white rounded-lg font-medium' 
                     : 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition'">
            Mes
          </button>
        </div>

        <div *ngIf="currentView === 'month'" class="flex items-center space-x-3">
          <button (click)="previousMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition">
            â—€
          </button>
          <span class="text-lg font-bold text-gray-900">
            {{ getMonthName() }} {{ currentYear }}
          </span>
          <button (click)="nextMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition">
            â–¶
          </button>
        </div>

        <div *ngIf="loading" class="flex items-center space-x-2 text-gray-500">
          <div class="animate-spin rounded-full h-5 w-5 border-2 border-green-600 border-t-transparent"></div>
          <span class="text-sm">Cargando...</span>
        </div>
      </div>
    </div>

    <!-- List View (Today & Week) -->
    <div *ngIf="currentView !== 'month'" class="p-6">
      <div class="space-y-3">
        <div 
          *ngFor="let event of events"
          class="bg-white rounded-lg shadow-md p-4 border-l-4 border-green-500 hover:shadow-lg transition">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <h3 class="text-lg font-bold text-gray-900 mb-1">{{ event.summary }}</h3>
              <p *ngIf="event.description" class="text-gray-600 text-sm mb-2">
                {{ event.description }}
              </p>
              <div class="flex items-center space-x-4 text-sm text-gray-500">
                <span class="flex items-center space-x-1">
                  <span>ğŸ•’</span>
                  <span>{{ formatDateTime(event.start) }}</span>
                </span>
                <span *ngIf="event.location" class="flex items-center space-x-1">
                  <span>ğŸ“</span>
                  <span>{{ event.location }}</span>
                </span>
              </div>
            </div>
            <div class="flex space-x-2">
              <a [href]="event.htmlLink" target="_blank" 
                 class="text-green-600 hover:text-green-700 transition">
                ğŸ”—
              </a>
              <button 
                (click)="deleteEvent(event.id)"
                class="text-red-600 hover:text-red-700 transition">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="events.length === 0 && !loading" class="text-center py-12 text-gray-400">
          <div class="text-6xl mb-4">ğŸ“…</div>
          <p class="text-lg">No hay eventos para este perÃ­odo</p>
        </div>
      </div>
    </div>

    <!-- Calendar Grid View (Month) -->
    <div *ngIf="currentView === 'month'" class="p-6">
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <!-- Day headers -->
        <div class="grid grid-cols-7 bg-gray-100 border-b border-gray-200">
          <div *ngFor="let day of ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b']" 
               class="p-3 text-center text-sm font-semibold text-gray-700">
            {{ day }}
          </div>
        </div>

        <!-- Calendar days -->
        <div class="grid grid-cols-7 divide-x divide-y divide-gray-200">
          <div 
            *ngFor="let dayObj of calendarDays"
            [class]="'p-2 min-h-[100px] ' + 
                     (dayObj.isCurrentMonth ? 'bg-white' : 'bg-gray-50') + ' ' +
                     (dayObj.isToday ? 'bg-green-50 border-2 border-green-500' : '') + ' ' +
                     (isHoliday(dayObj.date) ? 'bg-red-50' : '')"
            class="relative">
            <!-- Day number -->
            <div [class]="'text-sm font-medium mb-1 ' + 
                         (dayObj.isCurrentMonth ? 'text-gray-900' : 'text-gray-400') + ' ' +
                         (dayObj.isToday ? 'text-green-600 font-bold' : '')">
              {{ dayObj.day }}
            </div>

            <!-- Holiday name -->
            <div *ngIf="isHoliday(dayObj.date)" class="text-xs text-red-600 font-medium mb-1">
              ğŸ‰ {{ getHolidayName(dayObj.date) }}
            </div>

            <!-- Events for this day -->
            <div class="space-y-1">
              <div 
                *ngFor="let event of getEventsForDay(dayObj.date)"
                class="text-xs bg-green-500 text-white rounded px-2 py-1 truncate cursor-pointer hover:bg-green-600 transition"
                [title]="event.summary">
                {{ event.summary }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Event Modal -->
  <div *ngIf="showCreateModal" 
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
       (click)="closeModal()">
    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full" 
         (click)="$event.stopPropagation()">
      <div class="p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Nuevo Evento</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">TÃ­tulo *</label>
            <input
              type="text"
              [(ngModel)]="newEvent.summary"
              placeholder="TÃ­tulo del evento"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">DescripciÃ³n</label>
            <textarea
              [(ngModel)]="newEvent.description"
              rows="3"
              placeholder="DescripciÃ³n del evento"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 resize-none">
            </textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">UbicaciÃ³n</label>
            <input
              type="text"
              [(ngModel)]="newEvent.location"
              placeholder="UbicaciÃ³n del evento"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
          </div>

          <div class="flex items-center space-x-2">
            <input
              type="checkbox"
              [(ngModel)]="newEvent.allDay"
              id="allDay"
              class="w-4 h-4 text-green-600">
            <label for="allDay" class="text-sm text-gray-700">Evento de todo el dÃ­a</label>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Inicio *</label>
              <input
                type="datetime-local"
                [(ngModel)]="newEvent.startDateTime"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Fin *</label>
              <input
                type="datetime-local"
                [(ngModel)]="newEvent.endDateTime"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
          </div>
        </div>

        <div class="flex space-x-3 mt-6">
          <button
            (click)="createEvent()"
            [disabled]="!newEvent.summary.trim() || loading"
            class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition">
            {{ loading ? 'Creando...' : 'Crear Evento' }}
          </button>
          <button
            (click)="closeModal()"
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>