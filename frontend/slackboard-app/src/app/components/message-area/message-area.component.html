<div class="message-area-container">
  <!-- Ãrea de mensajes con scroll fijo -->
  <div #messageContainer class="messages-scroll-area">
    <!-- Estado de carga -->
    <div *ngIf="loading" class="flex justify-center items-center h-full">
      <div class="animate-pulse text-gray-500">Cargando mensajes...</div>
    </div>

    <!-- Sin canal seleccionado -->
    <div *ngIf="!channel && !loading" class="flex flex-col items-center justify-center h-full text-gray-500">
      <div class="text-6xl mb-4">ğŸ’¬</div>
      <p class="text-xl font-semibold">Selecciona un canal</p>
      <p class="text-sm">Elige un canal de la lista para comenzar a chatear</p>
    </div>

    <!-- Sin mensajes -->
    <div *ngIf="channel && messages.length === 0 && !loading" class="flex flex-col items-center justify-center h-full text-gray-500">
      <div class="text-6xl mb-4">âœ¨</div>
      <p class="text-xl font-semibold">Sin mensajes aÃºn</p>
      <p class="text-sm">SÃ© el primero en escribir en #{{ channel.name }}</p>
    </div>

    <!-- Lista de mensajes -->
    <div *ngIf="messages.length > 0" class="messages-list">
      <div *ngFor="let message of messages" class="message-item">
        <!-- Avatar -->
        <img 
          [src]="message.sender?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=default'" 
          [alt]="message.sender?.username"
          class="message-avatar">

        <!-- Contenido del mensaje -->
        <div class="message-content">
          <div class="message-header">
            <span class="message-username">{{ message.sender?.username || 'Usuario' }}</span>
            <span class="message-time">{{ formatTime(message.createdAt) }}</span>
            <span *ngIf="message.isEdited" class="message-edited">(editado)</span>
          </div>

          <!-- Texto del mensaje -->
          <p class="message-text">{{ message.content }}</p>

          <!-- Reacciones -->
          <div *ngIf="message.reactions && message.reactions.length > 0" class="message-reactions">
            <button 
              *ngFor="let reaction of message.reactions"
              (click)="addReaction(message._id, reaction.emoji)"
              class="reaction-button">
              <span>{{ reaction.emoji }}</span>
              <span class="reaction-count">{{ reaction.users?.length || 0 }}</span>
            </button>
          </div>

          <!-- Acciones del mensaje (al hacer hover) -->
          <div class="message-actions">
            <button (click)="addReaction(message._id, 'ğŸ‘')" title="Reaccionar">ğŸ‘</button>
            <button (click)="addReaction(message._id, 'â¤ï¸')" title="Reaccionar">â¤ï¸</button>
            <button (click)="addReaction(message._id, 'ğŸ˜‚')" title="Reaccionar">ğŸ˜‚</button>
          </div>
        </div>
      </div>

      <!-- Usuario escribiendo -->
      <div *ngIf="userTyping" class="typing-indicator">
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
        <span>{{ userTyping }} estÃ¡ escribiendo...</span>
      </div>
    </div>
  </div>

  <!-- Input para enviar mensajes (FIJO en la parte inferior) -->
  <div *ngIf="channel" class="message-input-container">
    <div class="message-input-wrapper">
      <!-- Campo de texto -->
      <div class="textarea-wrapper">
        <textarea
          [(ngModel)]="newMessage"
          (keydown)="onKeyDown($event)"
          (input)="onTyping()"
          placeholder="Escribe un mensaje en #{{ channel.name }}"
          rows="1"
          class="message-textarea"></textarea>
        
        <!-- BotÃ³n emoji (decorativo) -->
        <button class="emoji-button" title="Agregar emoji">ğŸ˜Š</button>
      </div>

      <!-- BotÃ³n enviar -->
      <button
        (click)="sendMessage()"
        [disabled]="!newMessage.trim()"
        class="send-button">
        Enviar
      </button>
    </div>

    <!-- InformaciÃ³n adicional -->
    <div class="input-info">
      <span>Presiona Enter para enviar, Shift+Enter para nueva lÃ­nea</span>
      <span *ngIf="channel.members">{{ channel.members.length }} miembros</span>
    </div>
  </div>
</div>